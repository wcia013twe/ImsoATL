{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/DashboardHeader.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\n\r\nexport default function DashboardHeader({\r\n  onToggleChat,\r\n  onToggleRecommendations,\r\n  cityName\r\n}: {\r\n  onToggleChat: () => void;\r\n  onToggleRecommendations?: () => void;\r\n  cityName?: string;\r\n}) {\r\n  const [darkMode, setDarkMode] = useState(true);\r\n\r\n  const toggleDarkMode = () => {\r\n    setDarkMode(!darkMode);\r\n    // You can add actual dark mode toggle logic here\r\n  };\r\n\r\n  const handleExport = (format: 'pdf' | 'csv' | 'kml') => {\r\n    console.log(`Exporting as ${format}...`);\r\n    // Export logic will be implemented later\r\n  };\r\n\r\n  return (\r\n    <header className=\"fixed top-0 left-0 right-0 z-50 border-b border-border bg-surface/95 backdrop-blur supports-[backdrop-filter]:bg-surface/80\">\r\n      <div className=\"flex items-center justify-between px-6 py-4\">\r\n        {/* Left: Logo/Title and Chat Toggle */}\r\n        <div className=\"flex items-center gap-4\">\r\n          <button\r\n            onClick={onToggleChat}\r\n            className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-civic-blue text-white font-semibold hover:bg-civic-blue-600 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\r\n            </svg>\r\n            Atlas\r\n          </button>\r\n\r\n          <div className=\"text-foreground\">\r\n            <span className=\"font-semibold text-lg\">{cityName || 'Select a City'}</span>\r\n            <span className=\"text-muted ml-2\">â€¢ WiFi Planning Dashboard</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right: Sites Button, Export Tools and Dark Mode Toggle */}\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Sites/Recommendations Button */}\r\n          {onToggleRecommendations && (\r\n            <button\r\n              onClick={onToggleRecommendations}\r\n              className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-civic-green text-white font-semibold hover:bg-civic-green-600 transition-colors\"\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n              </svg>\r\n              Sites\r\n            </button>\r\n          )}\r\n\r\n          {/* Export Buttons */}\r\n          <div className=\"flex items-center gap-2 mr-4\">\r\n            <span className=\"text-sm text-muted font-medium mr-2\">Export:</span>\r\n            <button\r\n              onClick={() => handleExport('pdf')}\r\n              className=\"px-3 py-1.5 rounded-lg border border-border text-sm font-medium text-foreground hover:bg-surface-hover transition-colors\"\r\n            >\r\n              PDF\r\n            </button>\r\n            <button\r\n              onClick={() => handleExport('csv')}\r\n              className=\"px-3 py-1.5 rounded-lg border border-border text-sm font-medium text-foreground hover:bg-surface-hover transition-colors\"\r\n            >\r\n              CSV\r\n            </button>\r\n            <button\r\n              onClick={() => handleExport('kml')}\r\n              className=\"px-3 py-1.5 rounded-lg border border-border text-sm font-medium text-foreground hover:bg-surface-hover transition-colors\"\r\n            >\r\n              KML\r\n            </button>\r\n          </div>\r\n\r\n          {/* Dark Mode Toggle */}\r\n          <button\r\n            onClick={toggleDarkMode}\r\n            className=\"p-2 rounded-lg border border-border hover:bg-surface-hover transition-colors\"\r\n            aria-label=\"Toggle dark mode\"\r\n          >\r\n            {darkMode ? (\r\n              <svg className=\"w-5 h-5 text-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n              </svg>\r\n            ) : (\r\n              <svg className=\"w-5 h-5 text-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n              </svg>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAAS,gBAAgB,EACtC,YAAY,EACZ,uBAAuB,EACvB,QAAQ,EAKT;IACC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,MAAM,iBAAiB;QACrB,YAAY,CAAC;IACb,iDAAiD;IACnD;IAEA,MAAM,eAAe,CAAC;QACpB,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,OAAO,GAAG,CAAC;IACvC,yCAAyC;IAC3C;IAEA,qBACE,8OAAC;QAAO,WAAU;kBAChB,cAAA,8OAAC;YAAI,WAAU;;8BAEb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,SAAS;4BACT,WAAU;;8CAEV,8OAAC;oCAAI,WAAU;oCAAU,MAAK;oCAAO,QAAO;oCAAe,SAAQ;8CACjE,cAAA,8OAAC;wCAAK,eAAc;wCAAQ,gBAAe;wCAAQ,aAAa;wCAAG,GAAE;;;;;;;;;;;gCACjE;;;;;;;sCAIR,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAK,WAAU;8CAAyB,YAAY;;;;;;8CACrD,8OAAC;oCAAK,WAAU;8CAAkB;;;;;;;;;;;;;;;;;;8BAKtC,8OAAC;oBAAI,WAAU;;wBAEZ,yCACC,8OAAC;4BACC,SAAS;4BACT,WAAU;;8CAEV,8OAAC;oCAAI,WAAU;oCAAU,MAAK;oCAAO,QAAO;oCAAe,SAAQ;;sDACjE,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;sDACrE,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;;;;;;;gCACjE;;;;;;;sCAMV,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAK,WAAU;8CAAsC;;;;;;8CACtD,8OAAC;oCACC,SAAS,IAAM,aAAa;oCAC5B,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,SAAS,IAAM,aAAa;oCAC5B,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,SAAS,IAAM,aAAa;oCAC5B,WAAU;8CACX;;;;;;;;;;;;sCAMH,8OAAC;4BACC,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEV,yBACC,8OAAC;gCAAI,WAAU;gCAA0B,MAAK;gCAAO,QAAO;gCAAe,SAAQ;0CACjF,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;qDAGvE,8OAAC;gCAAI,WAAU;gCAA0B,MAAK;gCAAO,QAAO;gCAAe,SAAQ;0CACjF,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQrF"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/ChatSidebar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport type { ChatMessage, AgentStep, WebSocketMessage, DeploymentPlan, MapOverlayEvent } from '@/lib/types';\n\r\nconst WEBSOCKET_URL = 'ws://localhost:8000/ws/chat';\r\nconst STORAGE_KEY = 'atlas-chat-messages';\r\n\r\nconst getInitialMessages = (): ChatMessage[] => {\r\n  if (typeof window === 'undefined') return getDefaultMessages();\r\n\r\n  try {\r\n    const stored = localStorage.getItem(STORAGE_KEY);\r\n    if (stored) {\r\n      const parsed = JSON.parse(stored);\r\n      // Convert timestamp strings back to Date objects\r\n      const messagesWithDates = parsed.map((msg: any) => ({\r\n        ...msg,\r\n        timestamp: new Date(msg.timestamp)\r\n      }));\r\n      return messagesWithDates.length > 0 ? messagesWithDates : getDefaultMessages();\r\n    }\r\n  } catch (error) {\r\n    console.error('Error loading chat messages:', error);\r\n  }\r\n\r\n  return getDefaultMessages();\r\n};\r\n\r\nconst getDefaultMessages = (): ChatMessage[] => [\r\n  {\r\n    id: '1',\r\n    role: 'assistant',\r\n    content: \"Hi! I'm your WiFi planning assistant powered by multi-agent AI. I analyze Census demographics, FCC broadband data, and civic assets to recommend optimal deployment sites. Ask me anything!\",\r\n    timestamp: new Date()\r\n  }\r\n];\r\n\r\nexport default function ChatSidebar({\n  isOpen,\n  onClose,\n  cityName,\n  onRecommendationsReceived,\n  onMapOverlayReceived\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  cityName?: string;\n  onRecommendationsReceived?: (plan: DeploymentPlan) => void;\n  onMapOverlayReceived?: (overlay: MapOverlayEvent) => void;\n}) {\n  const [messages, setMessages] = useState<ChatMessage[]>(getInitialMessages);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [showSuggestions, setShowSuggestions] = useState(true);\r\n  const [typingStep, setTypingStep] = useState<AgentStep | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const suggestions = [\r\n    \"Where should we deploy WiFi for underserved students?\",\r\n    \"Which areas have the worst broadband coverage gaps?\",\r\n    \"Show me high-poverty neighborhoods without internet access\",\r\n    \"Find the best sites near libraries and community centers\"\r\n  ];\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages, typingStep]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && inputRef.current) {\r\n      inputRef.current.focus();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Persist messages to localStorage whenever they change\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      try {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));\r\n      } catch (error) {\r\n        console.error('Error saving chat messages:', error);\r\n      }\r\n    }\r\n  }, [messages]);\r\n\r\n  const connectWebSocket = (userMessage: string) => {\r\n    const ws = new WebSocket(WEBSOCKET_URL);\r\n    wsRef.current = ws;\r\n    const processingMessageId = `processing-${Date.now()}`;\r\n\r\n    ws.onopen = () => {\r\n      console.log('WebSocket connected');\r\n\r\n      // Create ONE processing message that will accumulate all steps\r\n      const thinkingMessage: ChatMessage = {\r\n        id: processingMessageId,\r\n        role: 'assistant',\r\n        content: 'ðŸ¤” Analyzing your request...',\r\n        timestamp: new Date(),\r\n        type: 'processing',\r\n        agentSteps: []  // Initialize empty array for accumulation\r\n      };\r\n      setMessages(prev => [...prev, thinkingMessage]);\r\n\r\n      // Send user message to backend\r\n      ws.send(JSON.stringify({\r\n        message: userMessage,\r\n        city: cityName || 'Atlanta'\r\n      }));\r\n    };\r\n\r\n    ws.onmessage = (event) => {\n      const data: WebSocketMessage = JSON.parse(event.data);\n\n      if (data.type === 'map_overlay' && data.geojson) {\n        onMapOverlayReceived?.({\n          layer_id: data.layer_id,\n          overlay_id: data.overlay_id,\n          title: data.title,\n          description: data.description,\n          geojson: data.geojson,\n          metadata: data.metadata\n        });\n        return;\n      }\n\n      if (data.type === 'agent_step') {\n        const agentStep: AgentStep = {\r\n          agent: data.agent || '',\r\n          action: data.action || '',\r\n          status: data.status || 'in_progress',\r\n          data: data.data\r\n        };\r\n\r\n        // UPDATE the existing processing message by accumulating steps\r\n        setMessages(prev => prev.map(msg => {\r\n          if (msg.id === processingMessageId) {\r\n            const existingSteps = msg.agentSteps || [];\r\n            return {\r\n              ...msg,\r\n              agentSteps: [...existingSteps, agentStep],\r\n              content: `processing-${Date.now()}`,  // Change content to force re-render\r\n              timestamp: new Date()  // Update timestamp to force re-render\r\n            };\r\n          }\r\n          return msg;\r\n        }));\r\n\r\n        // Show typing indicator for current agent\r\n        setTypingStep({\r\n          agent: agentStep.agent,\r\n          action: agentStep.action,\r\n          status: agentStep.status\r\n        });\r\n      } else if (data.type === 'final_response') {\r\n        // Clear typing indicator\r\n        setTypingStep(null);\r\n\r\n        // Replace processing message with final response\r\n        setMessages(prev => prev.map(msg =>\r\n          msg.id === processingMessageId\r\n            ? {\r\n                ...msg,\r\n                content: data.explanation || 'Analysis complete.',\r\n                type: 'final_response',\r\n                deploymentPlan: data.deployment_plan\r\n              }\r\n            : msg\r\n        ));\r\n\r\n        setIsProcessing(false);\r\n\r\n        // Notify parent component of recommendations\r\n        if (data.deployment_plan && onRecommendationsReceived) {\r\n          onRecommendationsReceived(data.deployment_plan);\r\n        }\r\n\r\n        ws.close();\r\n      } else if (data.type === 'error') {\r\n        // Clear typing indicator\r\n        setTypingStep(null);\r\n\r\n        // Replace processing message with error\r\n        setMessages(prev => prev.map(msg =>\r\n          msg.id === processingMessageId\r\n            ? {\r\n                ...msg,\r\n                content: `âš ï¸ Error: ${data.message || 'An error occurred'}`,\r\n                type: 'error'\r\n              }\r\n            : msg\r\n        ));\r\n\r\n        setIsProcessing(false);\r\n        ws.close();\r\n      }\r\n    };\r\n\r\n    ws.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n      setTypingStep(null);\r\n\r\n      const errorMessage: ChatMessage = {\r\n        id: Date.now().toString(),\r\n        role: 'assistant',\r\n        content: 'âš ï¸ Connection error. Please make sure the backend server is running on port 8000.',\r\n        timestamp: new Date(),\r\n        type: 'error'\r\n      };\r\n      setMessages(prev => [...prev, errorMessage]);\r\n      setIsProcessing(false);\r\n    };\r\n\r\n    ws.onclose = () => {\r\n      console.log('WebSocket disconnected');\r\n      wsRef.current = null;\r\n    };\r\n  };\r\n\r\n  const handleSendMessage = async (text?: string) => {\r\n    const messageText = text || inputValue.trim();\r\n    if (!messageText || isProcessing) return;\r\n\r\n    // Add user message\r\n    const userMessage: ChatMessage = {\r\n      id: Date.now().toString(),\r\n      role: 'user',\r\n      content: messageText,\r\n      timestamp: new Date()\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setInputValue('');\r\n    setShowSuggestions(false);\r\n    setIsProcessing(true);\r\n\r\n    // Connect to WebSocket and send message\r\n    connectWebSocket(messageText);\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSendMessage();\r\n    }\r\n  };\r\n\r\n  const handleClearConversation = () => {\r\n    if (confirm('Are you sure you want to clear the conversation history?')) {\r\n      const defaultMessages = getDefaultMessages();\r\n      setMessages(defaultMessages);\r\n      setShowSuggestions(true);\r\n      if (typeof window !== 'undefined') {\r\n        localStorage.removeItem(STORAGE_KEY);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getAgentIcon = (agentName: string): string => {\r\n    if (agentName.includes('Query Parser')) return 'ðŸ”';\r\n    if (agentName.includes('Census')) return 'ðŸ“Š';\r\n    if (agentName.includes('FCC')) return 'ðŸ“¡';\r\n    if (agentName.includes('Assets')) return 'ðŸ›ï¸';\r\n    if (agentName.includes('Synthesis')) return 'ðŸ§ ';\r\n    if (agentName.includes('Ranking')) return 'âš–ï¸';\r\n    if (agentName.includes('Explainer')) return 'âœ¨';\r\n    return 'ðŸ¤–';\r\n  };\r\n\r\n  const isOrchestratorThinking = (step: AgentStep): boolean => {\r\n    return step.agent.includes('Orchestrator') && step.status === 'completed';\r\n  };\r\n\r\n  const isProcessRunning = (step: AgentStep): boolean => {\r\n    return step.status === 'in_progress' && !step.agent.includes('Orchestrator');\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Sidebar */}\r\n      <div\r\n        className={`fixed top-0 left-0 h-full w-[32rem] bg-surface border-r border-border z-50 transform transition-transform duration-300 ease-in-out ${\r\n          isOpen ? 'translate-x-0' : '-translate-x-full'\r\n        }`}\r\n      >\r\n        <div className=\"flex flex-col h-full\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-border\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-2 h-2 rounded-full bg-civic-green animate-pulse\" />\r\n              <h2 className=\"text-lg font-semibold text-foreground\">Multi-Agent AI Assistant</h2>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={handleClearConversation}\r\n                className=\"p-1 rounded-lg hover:bg-surface-hover transition-colors text-muted hover:text-foreground\"\r\n                title=\"Clear conversation\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                </svg>\r\n              </button>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-1 rounded-lg hover:bg-surface-hover transition-colors text-muted hover:text-foreground\"\r\n                title=\"Close chat\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Messages */}\r\n          <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-4\">\r\n            {messages.map((message) => (\r\n              <div\r\n                key={message.id}\r\n                className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\r\n              >\r\n                <div\r\n                  className={`max-w-[90%] rounded-2xl px-4 py-3 ${\r\n                    message.role === 'user'\r\n                      ? 'bg-civic-blue text-white'\r\n                      : message.type === 'agent_step'\r\n                      ? 'bg-surface-hover border border-border'\r\n                      : 'bg-surface-hover text-foreground border border-border'\r\n                  }`}\r\n                >\r\n                  {/* Processing Message - Shows all accumulated agent steps */}\r\n                  {message.type === 'processing' && message.agentSteps && (\r\n                    <div className=\"text-xs space-y-2\">\r\n                      <div className=\"font-semibold text-muted mb-2\">ðŸ¤” Analyzing your request...</div>\r\n                      {message.agentSteps.map((step, idx) => (\r\n                        <div key={idx} className=\"flex items-start gap-2 pl-2 border-l-2 border-civic-blue/30\">\r\n                          <span className=\"flex-shrink-0 mt-0.5\">{getAgentIcon(step.agent)}</span>\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"font-semibold text-foreground flex items-center gap-2\">\r\n                              {step.agent}\r\n                              {step.status === 'in_progress' && (\r\n                                <svg className=\"w-3 h-3 animate-spin text-civic-blue\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                                </svg>\r\n                              )}\r\n                              {step.status === 'completed' && (\r\n                                <span className=\"text-civic-green\">âœ“</span>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"text-accent mt-0.5\">{step.action}</div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Agent Step Message */}\r\n                  {message.type === 'agent_step' && message.agentSteps?.[0] && (\r\n                    <div className=\"text-xs flex items-start gap-2\">\r\n                      <span className=\"flex-shrink-0 mt-0.5\">{getAgentIcon(message.agentSteps[0].agent)}</span>\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"font-semibold text-foreground flex items-center gap-2\">\r\n                          {message.agentSteps[0].agent}\r\n                          {isProcessRunning(message.agentSteps[0]) && (\r\n                            <svg className=\"w-3 h-3 animate-spin text-civic-blue\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                            </svg>\r\n                          )}\r\n                          {message.agentSteps[0].status === 'completed' && !isOrchestratorThinking(message.agentSteps[0]) && (\r\n                            <span className=\"text-civic-green\">âœ“</span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"text-accent mt-1\">\r\n                          {message.content}\r\n                          {isOrchestratorThinking(message.agentSteps[0]) && (\r\n                            <span className=\"inline-flex ml-1\">\r\n                              <span className=\"animate-[bounce_1s_infinite_0ms]\">.</span>\r\n                              <span className=\"animate-[bounce_1s_infinite_200ms]\">.</span>\r\n                              <span className=\"animate-[bounce_1s_infinite_400ms]\">.</span>\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Regular Message */}\r\n                  {message.type !== \"agent_step\" && message.type !== \"processing\" && (\r\n                    <>\r\n                      <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">{message.content}</p>\r\n\r\n                      <span className={`text-xs mt-2 block ${\r\n                        message.role === 'user' ? 'text-white/70' : 'text-muted'\r\n                      }`}>\r\n                        {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {/* Typing Indicator */}\r\n            {isProcessing && typingStep && (\r\n              <div className=\"flex justify-start\">\r\n                <div className=\"max-w-[90%] bg-surface-hover border border-border rounded-2xl px-4 py-3\">\r\n                  <div className=\"text-xs flex items-start gap-2\">\r\n                    <span className=\"flex-shrink-0 mt-0.5\">{getAgentIcon(typingStep.agent)}</span>\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"font-semibold text-foreground\">{typingStep.agent}</div>\r\n                      <div className=\"text-accent mt-1\">\r\n                        <span className=\"inline-flex gap-0.5\">\r\n                          <span className=\"animate-[bounce_1s_infinite_0ms]\">.</span>\r\n                          <span className=\"animate-[bounce_1s_infinite_200ms]\">.</span>\r\n                          <span className=\"animate-[bounce_1s_infinite_400ms]\">.</span>\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n\r\n          {/* Suggestions */}\r\n          {showSuggestions && messages.length === 1 && (\r\n            <div className=\"px-6 pb-4\">\r\n              <div className=\"text-xs font-semibold text-muted uppercase tracking-wider mb-3\">\r\n                Suggested Questions\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                {suggestions.map((suggestion, index) => (\r\n                  <button\r\n                    key={index}\r\n                    onClick={() => handleSendMessage(suggestion)}\r\n                    className=\"w-full text-left px-3 py-2 rounded-lg border border-border text-sm text-accent hover:bg-surface-hover hover:text-foreground transition-colors\"\r\n                  >\r\n                    {suggestion}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Input */}\r\n          <div className=\"px-6 py-4 border-t border-border\">\r\n            <div className=\"flex gap-2\">\r\n              <input\r\n                ref={inputRef}\r\n                type=\"text\"\r\n                value={inputValue}\r\n                onChange={(e) => setInputValue(e.target.value)}\r\n                onKeyPress={handleKeyPress}\r\n                placeholder=\"Ask me about WiFi deployment...\"\r\n                disabled={isProcessing}\r\n                className=\"flex-1 px-4 py-3 rounded-xl bg-background border border-border text-foreground placeholder-muted focus:outline-none focus:ring-2 focus:ring-civic-blue focus:border-transparent disabled:opacity-50\"\r\n              />\r\n              <button\r\n                onClick={() => handleSendMessage()}\r\n                disabled={!inputValue.trim() || isProcessing}\r\n                className=\"px-4 py-3 rounded-xl bg-civic-blue text-white font-semibold hover:bg-civic-blue-600 transition-colors disabled:opacity-40 disabled:cursor-not-allowed\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1072, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/lib/mapbox-config.ts"],"sourcesContent":["/**\r\n * Mapbox Configuration\r\n * Layer definitions, styles, and data sources\r\n */\r\n\r\nexport const MAPBOX_CONFIG = {\r\n  accessToken: process.env.NEXT_PUBLIC_MAPBOX_TOKEN || process.env.NEXT_PUBLIC_MAPBOX || '',\r\n  defaultStyle: 'mapbox://styles/mapbox/light-v11',\r\n  atlantaCenter: {\r\n    lng: -84.388,\r\n    lat: 33.749,\r\n    zoom: 10.5,\r\n  },\r\n};\r\n\r\nexport const MAP_LAYERS = {\r\n  // Atlanta city boundary\r\n  atlantaBoundary: {\r\n    id: 'atlanta-boundary',\r\n    type: 'line' as const,\r\n    source: 'atlanta-boundary',\r\n    paint: {\r\n      'line-color': '#2691FF',\r\n      'line-width': 3,\r\n      'line-opacity': 0.8,\r\n    },\r\n  },\r\n\r\n  // Census heat map - poverty rate\r\n  censusPoverty: {\r\n    id: 'census-poverty',\r\n    type: 'fill' as const,\r\n    source: 'census-poverty',\r\n    paint: {\r\n      'fill-color': [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'poverty_rate'],\r\n        0, '#E8F8F3',\r\n        10, '#A3E3CF',\r\n        20, '#47C79F',\r\n        30, '#19B987',\r\n        40, '#0F6F51',\r\n      ],\r\n      'fill-opacity': 0.6,\r\n    },\r\n  },\r\n\r\n  // Census heat map - internet access\r\n  censusInternet: {\r\n    id: 'census-internet',\r\n    type: 'fill' as const,\r\n    source: 'census-internet',\r\n    paint: {\r\n      'fill-color': [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'no_internet_pct'],\r\n        0, '#E8F4FF',\r\n        10, '#A8D3FF',\r\n        20, '#51A7FF',\r\n        30, '#2691FF',\r\n        40, '#0058B3',\r\n      ],\r\n      'fill-opacity': 0.6,\r\n    },\r\n  },\r\n\r\n  // FCC broadband coverage\r\n  fccBroadband: {\r\n    id: 'fcc-broadband',\r\n    type: 'fill' as const,\r\n    source: 'fcc-broadband',\r\n    paint: {\r\n      'fill-color': [\r\n        'match',\r\n        ['get', 'has_coverage'],\r\n        true, '#19B987',\r\n        false, '#FFB84D',\r\n        '#6B7280',\r\n      ],\r\n      'fill-opacity': 0.4,\r\n    },\r\n  },\r\n\r\n  // Local assets - libraries\r\n  libraries: {\r\n    id: 'libraries',\r\n    type: 'circle' as const,\r\n    source: 'libraries',\r\n    paint: {\r\n      'circle-radius': 8,\r\n      'circle-color': '#7C3AED',\r\n      'circle-stroke-width': 2,\r\n      'circle-stroke-color': '#FFFFFF',\r\n    },\r\n  },\r\n\r\n  // Local assets - community centers\r\n  communityCenters: {\r\n    id: 'community-centers',\r\n    type: 'circle' as const,\r\n    source: 'community-centers',\r\n    paint: {\r\n      'circle-radius': 8,\r\n      'circle-color': '#DC2626',\r\n      'circle-stroke-width': 2,\r\n      'circle-stroke-color': '#FFFFFF',\r\n    },\r\n  },\r\n\r\n  // Local assets - transit stops\r\n  transitStops: {\r\n    id: 'transit-stops',\r\n    type: 'circle' as const,\r\n    source: 'transit-stops',\r\n    paint: {\r\n      'circle-radius': 6,\r\n      'circle-color': '#7DBDFF',\r\n      'circle-stroke-width': 1,\r\n      'circle-stroke-color': '#FFFFFF',\r\n    },\r\n  },\r\n\r\n  // Candidate WiFi sites\r\n  candidateSites: {\r\n    id: 'candidate-sites',\r\n    type: 'circle' as const,\r\n    source: 'candidate-sites',\r\n    paint: {\r\n      'circle-radius': 12,\r\n      'circle-color': '#2691FF',\r\n      'circle-stroke-width': 3,\r\n      'circle-stroke-color': '#FFFFFF',\r\n    },\r\n  },\r\n\r\n  // Existing WiFi coverage\r\n  existingWifi: {\r\n    id: 'existing-wifi',\r\n    type: 'circle' as const,\r\n    source: 'existing-wifi',\r\n    paint: {\r\n      'circle-radius': 10,\r\n      'circle-color': '#6B7280',\r\n      'circle-stroke-width': 2,\r\n      'circle-stroke-color': '#FFFFFF',\r\n      'circle-opacity': 0.7,\r\n    },\r\n  },\r\n};\r\n\r\nexport const LAYER_GROUPS = {\r\n  'Census Data': ['census-poverty', 'census-internet'],\r\n  'FCC Coverage': ['fcc-broadband'],\r\n  'Local Assets': ['libraries', 'community-centers', 'transit-stops'],\r\n  'WiFi Sites': ['candidate-sites', 'existing-wifi'],\r\n  'Boundaries': ['atlanta-boundary'],\r\n};\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAEM,MAAM,gBAAgB;IAC3B,aAAa,qIAAwC,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACvF,cAAc;IACd,eAAe;QACb,KAAK,CAAC;QACN,KAAK;QACL,MAAM;IACR;AACF;AAEO,MAAM,aAAa;IACxB,wBAAwB;IACxB,iBAAiB;QACf,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,cAAc;YACd,cAAc;YACd,gBAAgB;QAClB;IACF;IAEA,iCAAiC;IACjC,eAAe;QACb,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,cAAc;gBACZ;gBACA;oBAAC;iBAAS;gBACV;oBAAC;oBAAO;iBAAe;gBACvB;gBAAG;gBACH;gBAAI;gBACJ;gBAAI;gBACJ;gBAAI;gBACJ;gBAAI;aACL;YACD,gBAAgB;QAClB;IACF;IAEA,oCAAoC;IACpC,gBAAgB;QACd,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,cAAc;gBACZ;gBACA;oBAAC;iBAAS;gBACV;oBAAC;oBAAO;iBAAkB;gBAC1B;gBAAG;gBACH;gBAAI;gBACJ;gBAAI;gBACJ;gBAAI;gBACJ;gBAAI;aACL;YACD,gBAAgB;QAClB;IACF;IAEA,yBAAyB;IACzB,cAAc;QACZ,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,cAAc;gBACZ;gBACA;oBAAC;oBAAO;iBAAe;gBACvB;gBAAM;gBACN;gBAAO;gBACP;aACD;YACD,gBAAgB;QAClB;IACF;IAEA,2BAA2B;IAC3B,WAAW;QACT,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,iBAAiB;YACjB,gBAAgB;YAChB,uBAAuB;YACvB,uBAAuB;QACzB;IACF;IAEA,mCAAmC;IACnC,kBAAkB;QAChB,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,iBAAiB;YACjB,gBAAgB;YAChB,uBAAuB;YACvB,uBAAuB;QACzB;IACF;IAEA,+BAA+B;IAC/B,cAAc;QACZ,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,iBAAiB;YACjB,gBAAgB;YAChB,uBAAuB;YACvB,uBAAuB;QACzB;IACF;IAEA,uBAAuB;IACvB,gBAAgB;QACd,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,iBAAiB;YACjB,gBAAgB;YAChB,uBAAuB;YACvB,uBAAuB;QACzB;IACF;IAEA,yBAAyB;IACzB,cAAc;QACZ,IAAI;QACJ,MAAM;QACN,QAAQ;QACR,OAAO;YACL,iBAAiB;YACjB,gBAAgB;YAChB,uBAAuB;YACvB,uBAAuB;YACvB,kBAAkB;QACpB;IACF;AACF;AAEO,MAAM,eAAe;IAC1B,eAAe;QAAC;QAAkB;KAAkB;IACpD,gBAAgB;QAAC;KAAgB;IACjC,gBAAgB;QAAC;QAAa;QAAqB;KAAgB;IACnE,cAAc;QAAC;QAAmB;KAAgB;IAClD,cAAc;QAAC;KAAmB;AACpC"}},
    {"offset": {"line": 1270, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/MapLayerControl.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\n\r\ntype LayerControlProps = {\r\n  layers: {\r\n    id: string;\r\n    label: string;\r\n    color: string;\r\n    description?: string;\r\n  }[];\r\n  activeLayers: string[];\r\n  onToggle: (layerId: string) => void;\r\n};\r\n\r\nexport default function MapLayerControl({\r\n  layers,\r\n  activeLayers,\r\n  onToggle,\r\n}: LayerControlProps) {\r\n  const [isExpanded, setIsExpanded] = useState(true);\r\n\r\n  return (\r\n    <div className=\"absolute top-4 right-4 bg-surface rounded-lg shadow-lg max-w-xs z-10 border border-border\">\r\n      {/* Header with Toggle */}\r\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-border\">\r\n        <h3 className=\"text-sm font-semibold text-foreground\">Map Layers</h3>\r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"p-1 rounded-lg hover:bg-surface-hover transition-colors text-muted hover:text-foreground\"\r\n          title={isExpanded ? 'Hide map key' : 'Show map key'}\r\n        >\r\n          <svg\r\n            className={`w-4 h-4 transition-transform ${isExpanded ? 'rotate-180' : ''}`}\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Collapsible Content */}\r\n      {isExpanded && (\r\n        <div className=\"p-4 space-y-2\">\r\n          {layers.map((layer) => (\r\n            <button\r\n              key={layer.id}\r\n              onClick={() => onToggle(layer.id)}\r\n              className=\"w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors hover:bg-surface-hover\"\r\n            >\r\n              <div\r\n                className=\"w-4 h-4 rounded shrink-0 border-2\"\r\n                style={{\r\n                  backgroundColor: activeLayers.includes(layer.id) ? layer.color : 'transparent',\r\n                  borderColor: layer.color,\r\n                }}\r\n              />\r\n              <div className=\"flex-1 text-left\">\r\n                <div className=\"text-sm font-medium text-foreground\">{layer.label}</div>\r\n                {layer.description && (\r\n                  <div className=\"text-xs text-muted\">{layer.description}</div>\r\n                )}\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAee,SAAS,gBAAgB,EACtC,MAAM,EACN,YAAY,EACZ,QAAQ,EACU;IAClB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAwC;;;;;;kCACtD,8OAAC;wBACC,SAAS,IAAM,cAAc,CAAC;wBAC9B,WAAU;wBACV,OAAO,aAAa,iBAAiB;kCAErC,cAAA,8OAAC;4BACC,WAAW,CAAC,6BAA6B,EAAE,aAAa,eAAe,IAAI;4BAC3E,MAAK;4BACL,QAAO;4BACP,SAAQ;sCAER,cAAA,8OAAC;gCAAK,eAAc;gCAAQ,gBAAe;gCAAQ,aAAa;gCAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;YAM1E,4BACC,8OAAC;gBAAI,WAAU;0BACZ,OAAO,GAAG,CAAC,CAAC,sBACX,8OAAC;wBAEC,SAAS,IAAM,SAAS,MAAM,EAAE;wBAChC,WAAU;;0CAEV,8OAAC;gCACC,WAAU;gCACV,OAAO;oCACL,iBAAiB,aAAa,QAAQ,CAAC,MAAM,EAAE,IAAI,MAAM,KAAK,GAAG;oCACjE,aAAa,MAAM,KAAK;gCAC1B;;;;;;0CAEF,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAuC,MAAM,KAAK;;;;;;oCAChE,MAAM,WAAW,kBAChB,8OAAC;wCAAI,WAAU;kDAAsB,MAAM,WAAW;;;;;;;;;;;;;uBAdrD,MAAM,EAAE;;;;;;;;;;;;;;;;AAuB3B"}},
    {"offset": {"line": 1394, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/InteractiveMap.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport \"mapbox-gl/dist/mapbox-gl.css\";\r\nimport * as turf from \"@turf/turf\";\r\nimport { MAPBOX_CONFIG, MAP_LAYERS } from \"@/lib/mapbox-config\";\nimport MapLayerControl from \"./MapLayerControl\";\nimport type { DeploymentPlan, MapOverlayEvent } from \"@/lib/types\";\nimport type { FeatureCollection } from \"geojson\";\n\r\n// Mock data sources - replace with real data in backend integration\r\nconst MOCK_DATA = {\r\n  atlantaBoundary: {\r\n    type: \"FeatureCollection\" as const,\r\n    features: [\r\n      {\r\n        type: \"Feature\" as const,\r\n        geometry: {\r\n          type: \"Polygon\" as const,\r\n          coordinates: [\r\n            [\r\n              [-84.55, 33.65],\r\n              [-84.55, 33.89],\r\n              [-84.29, 33.89],\r\n              [-84.29, 33.65],\r\n              [-84.55, 33.65],\r\n            ],\r\n          ],\r\n        },\r\n        properties: {},\r\n      },\r\n    ],\r\n  },\r\n  libraries: {\r\n    type: \"FeatureCollection\" as const,\r\n    features: [\r\n      {\r\n        type: \"Feature\" as const,\r\n        geometry: { type: \"Point\" as const, coordinates: [-84.408, 33.749] },\r\n        properties: { name: \"Central Library\", type: \"library\" },\r\n      },\r\n      {\r\n        type: \"Feature\" as const,\r\n        geometry: { type: \"Point\" as const, coordinates: [-84.428, 33.738] },\r\n        properties: { name: \"Southwest Library\", type: \"library\" },\r\n      },\r\n    ],\r\n  },\r\n  candidateSites: {\r\n    type: \"FeatureCollection\" as const,\r\n    features: [\r\n      {\r\n        type: \"Feature\" as const,\r\n        geometry: { type: \"Point\" as const, coordinates: [-84.408, 33.755] },\r\n        properties: { name: \"Candidate Site 1\", reach: 2200, equityScore: 9.2 },\r\n      },\r\n    ],\r\n  },\r\n};\r\n\r\nconst LAYER_CONFIG = [\r\n  { id: \"city-boundary\", label: \"City Boundary\", color: \"#2691FF\" },\r\n  {\r\n    id: \"census-poverty\",\r\n    label: \"Poverty Rate\",\r\n    color: \"#19B987\",\r\n    description: \"Census tract poverty data\",\r\n  },\r\n  {\r\n    id: \"census-internet\",\r\n    label: \"Internet Access\",\r\n    color: \"#2691FF\",\r\n    description: \"Households without internet\",\r\n  },\r\n  {\r\n    id: \"fcc-broadband\",\r\n    label: \"FCC Coverage\",\r\n    color: \"#FFB84D\",\r\n    description: \"Federal broadband data\",\r\n  },\r\n  { id: \"libraries\", label: \"Libraries\", color: \"#7C3AED\" },\r\n  { id: \"community-centers\", label: \"Community Centers\", color: \"#DC2626\" },\r\n  { id: \"transit-stops\", label: \"Transit Stops\", color: \"#7DBDFF\" },\r\n  { id: \"candidate-sites\", label: \"Candidate Sites\", color: \"#2691FF\" },\r\n  { id: \"existing-wifi\", label: \"Existing WiFi\", color: \"#6B7280\" },\r\n];\r\n\r\nexport default function InteractiveMap({\n  cityCenter,\n  cityName,\n  citySlug,\n  recommendations,\n  overlayEvent,\n  mapRefProp,\n}: {\n  cityCenter?: [number, number];\n  cityName?: string;\n  citySlug?: string;\n  recommendations?: DeploymentPlan | null;\n  overlayEvent?: MapOverlayEvent | null;\n  mapRefProp?: React.MutableRefObject<{\n    showRecommendations: (plan: DeploymentPlan) => void;\n    centerOnSite: (siteIndex: number) => void;\n  } | null>;\n}) {\n  const mapContainer = useRef<HTMLDivElement>(null);\r\n  const map = useRef<mapboxgl.Map | null>(null);\r\n  const [activeLayers, setActiveLayers] = useState<string[]>([\r\n    \"city-boundary\",\r\n    \"libraries\",\r\n    \"candidate-sites\",\r\n  ]);\r\n  const [mapLoaded, setMapLoaded] = useState(false);\n  const [siteCoordinates, setSiteCoordinates] = useState<[number, number][]>([]);\n  const overlayLayerIdRef = useRef<string | null>(null);\n\r\n  // Use provided city coordinates or default to Atlanta\r\n  const mapCenter = cityCenter || [\r\n    MAPBOX_CONFIG.atlantaCenter.lng,\r\n    MAPBOX_CONFIG.atlantaCenter.lat,\r\n  ];\r\n  const mapZoom = cityCenter ? 11.5 : MAPBOX_CONFIG.atlantaCenter.zoom;\n  const boundarySlug = citySlug || \"atlanta\";\n  const overlayLayerConfig = overlayEvent\n    ? [\n        {\n          id: overlayEvent.layer_id || \"demographic-hotspots\",\n          label: overlayEvent.title || \"Demographic Hotspots\",\n          color: \"#0F6F51\",\n          description:\n            overlayEvent.description ||\n            \"Highlighted tracts from the Demographics Agent\",\n        },\n      ]\n    : [];\n  const layerControlConfig = [...LAYER_CONFIG, ...overlayLayerConfig];\n\r\n  // Expose methods via ref\r\n  useEffect(() => {\n    if (mapRefProp) {\n      mapRefProp.current = {\n        showRecommendations: (plan: DeploymentPlan) => {\n          // Handle showing recommendations\n          console.log('Show recommendations:', plan);\n        },\n        centerOnSite: (siteIndex: number) => {\r\n          if (siteCoordinates[siteIndex] && map.current && recommendations) {\r\n            const coords = siteCoordinates[siteIndex];\r\n            const site = recommendations.recommended_sites[siteIndex];\r\n\r\n            // Fly to the site location\r\n            map.current.flyTo({\r\n              center: coords,\r\n              zoom: 14,\r\n              duration: 1000,\r\n              essential: true\r\n            });\r\n\r\n            // Open popup after a short delay to ensure map has centered\r\n            setTimeout(() => {\r\n              if (!map.current) return;\r\n\r\n              new mapboxgl.Popup()\r\n                .setLngLat(coords)\r\n                .setHTML(\r\n                  `\r\n                  <div style=\"font-family: system-ui; padding: 4px;\">\r\n                    <strong style=\"color: #1f2937; font-size: 14px;\">${site.name || `Site ${siteIndex + 1}`}</strong><br/>\r\n                    <div style=\"margin-top: 8px; font-size: 12px; color: #6b7280;\">\r\n                      <div><strong>Score:</strong> ${site.composite_score}/100</div>\r\n                      <div><strong>Poverty Rate:</strong> ${site.poverty_rate}%</div>\r\n                      <div><strong>No Internet:</strong> ${site.no_internet_pct}%</div>\r\n                      <div><strong>Priority:</strong> ${site.recommendation_tier}</div>\r\n                    </div>\r\n                  </div>\r\n                `\r\n                )\r\n                .addTo(map.current);\r\n            }, 500);\r\n          }\r\n        }\r\n      };\n    }\n  }, [mapRefProp, siteCoordinates, recommendations]);\n\n  useEffect(() => {\n    if (!map.current || !mapLoaded || !overlayEvent || !overlayEvent.geojson) {\n      return;\n    }\n\n    const sourceId = overlayEvent.layer_id || \"demographic-hotspots\";\n    const layerId = sourceId;\n    const overlayData = overlayEvent.geojson as FeatureCollection;\n    overlayLayerIdRef.current = layerId;\n\n    if (map.current.getSource(sourceId)) {\n      (map.current.getSource(sourceId) as mapboxgl.GeoJSONSource).setData(\n        overlayData as any\n      );\n    } else {\n      map.current.addSource(sourceId, {\n        type: \"geojson\",\n        data: overlayData,\n      });\n\n      map.current.addLayer({\n        id: layerId,\n        type: \"fill\",\n        source: sourceId,\n        paint: {\n          \"fill-color\": [\n            \"interpolate\",\n            [\"linear\"],\n            [\"get\", \"poverty_rate\"],\n            0,\n            \"#E8F8F3\",\n            20,\n            \"#A3E3CF\",\n            40,\n            \"#47C79F\",\n            60,\n            \"#0F6F51\",\n          ],\n          \"fill-opacity\": 0.6,\n        },\n      });\n\n      map.current.addLayer({\n        id: `${layerId}-outline`,\n        type: \"line\",\n        source: sourceId,\n        paint: {\n          \"line-color\": \"#0F172A\",\n          \"line-width\": 1.2,\n        },\n      });\n    }\n\n    setActiveLayers((prev) =>\n      prev.includes(layerId) ? prev : [...prev, layerId]\n    );\n  }, [overlayEvent, mapLoaded]);\n\r\n  // Initialize map\r\n  useEffect(() => {\r\n    if (!mapContainer.current || map.current) return;\r\n\r\n    mapboxgl.accessToken = MAPBOX_CONFIG.accessToken;\r\n\r\n    map.current = new mapboxgl.Map({\r\n      container: mapContainer.current,\r\n      style: MAPBOX_CONFIG.defaultStyle,\r\n      center: mapCenter,\r\n      zoom: mapZoom,\r\n    });\r\n\r\n    map.current.on(\"load\", () => {\r\n      if (!map.current) return;\r\n\r\n      // Load pre-generated city boundary\r\n      fetch(`/data/cities/${boundarySlug}.json`)\r\n        .then((response) => response.json())\r\n        .then((cityBoundary) => {\r\n          if (!map.current) return;\r\n\r\n          console.log(`Loaded pre-generated ${boundarySlug} boundary`);\r\n\r\n          // Add city boundary source with pre-processed boundary\r\n          map.current.addSource(\"city-boundary\", {\r\n            type: \"geojson\",\r\n            data: {\r\n              type: \"FeatureCollection\" as const,\r\n              features: [cityBoundary],\r\n            },\r\n          });\r\n\r\n          // Add the clean outer boundary layer\r\n          map.current.addLayer({\r\n            id: \"city-boundary\",\r\n            type: \"line\",\r\n            source: \"city-boundary\",\r\n            paint: {\r\n              \"line-color\": \"#2691FF\",\r\n              \"line-width\": 3,\r\n              \"line-opacity\": 0.8,\r\n            },\r\n          });\r\n\r\n          // Auto-zoom map to fit city boundary perfectly\r\n          const bounds = cityBoundary.properties.bounds;\r\n          if (bounds && bounds.length === 2) {\r\n            console.log(`Fitting map to ${boundarySlug} bounds:`, bounds);\r\n            map.current.fitBounds(bounds, {\r\n              padding: 50,\r\n              duration: 1000,\r\n              maxZoom: 11.5,\r\n            });\r\n          }\r\n\r\n          console.log(`${boundarySlug} boundary displayed successfully`);\r\n        })\r\n        .catch((error) => {\r\n          console.error(`Error loading ${boundarySlug} boundary:`, error);\r\n          // Fallback to mock data if boundary file fails to load\r\n          if (map.current) {\r\n            map.current.addSource(\"city-boundary\", {\r\n              type: \"geojson\",\r\n              data: MOCK_DATA.atlantaBoundary,\r\n            });\r\n            map.current.addLayer({\r\n              id: \"city-boundary\",\r\n              type: \"line\",\r\n              source: \"city-boundary\",\r\n              paint: {\r\n                \"line-color\": \"#2691FF\",\r\n                \"line-width\": 3,\r\n                \"line-opacity\": 0.8,\r\n              },\r\n            });\r\n          }\r\n        });\r\n\r\n      // Add other data sources\r\n      map.current.addSource(\"libraries\", {\r\n        type: \"geojson\",\r\n        data: MOCK_DATA.libraries,\r\n      });\r\n\r\n      map.current.addSource(\"candidate-sites\", {\r\n        type: \"geojson\",\r\n        data: MOCK_DATA.candidateSites,\r\n      });\r\n\r\n      // Add other layers\r\n      map.current.addLayer(MAP_LAYERS.libraries);\r\n      map.current.addLayer(MAP_LAYERS.candidateSites);\r\n\r\n      // Add click handlers for popups with centering\r\n      map.current.on(\"click\", \"libraries\", (e) => {\r\n        if (!map.current || !e.features || !e.features[0]) return;\r\n        const feature = e.features[0];\r\n\r\n        // Center map on clicked point\r\n        map.current.flyTo({\r\n          center: e.lngLat,\r\n          zoom: 14,\r\n          duration: 1000,\r\n          essential: true\r\n        });\r\n\r\n        new mapboxgl.Popup()\r\n          .setLngLat(e.lngLat)\r\n          .setHTML(\r\n            `<strong>${feature.properties?.name}</strong><br/>Type: Library`\r\n          )\r\n          .addTo(map.current);\r\n      });\r\n\r\n      map.current.on(\"click\", \"candidate-sites\", (e) => {\r\n        if (!map.current || !e.features || !e.features[0]) return;\r\n        const feature = e.features[0];\r\n\r\n        // Center map on clicked point\r\n        map.current.flyTo({\r\n          center: e.lngLat,\r\n          zoom: 14,\r\n          duration: 1000,\r\n          essential: true\r\n        });\r\n\r\n        new mapboxgl.Popup()\r\n          .setLngLat(e.lngLat)\r\n          .setHTML(\r\n            `\r\n            <strong>${feature.properties?.name}</strong><br/>\r\n            Reach: ${feature.properties?.reach} residents<br/>\r\n            Equity Score: ${feature.properties?.equityScore}\r\n          `\r\n          )\r\n          .addTo(map.current);\r\n      });\r\n\r\n      // Change cursor on hover\r\n      map.current.on(\"mouseenter\", \"libraries\", () => {\r\n        if (map.current) map.current.getCanvas().style.cursor = \"pointer\";\r\n      });\r\n      map.current.on(\"mouseleave\", \"libraries\", () => {\r\n        if (map.current) map.current.getCanvas().style.cursor = \"\";\r\n      });\r\n\r\n      setMapLoaded(true);\r\n    });\r\n\r\n    return () => {\r\n      map.current?.remove();\r\n      map.current = null;\r\n    };\r\n  }, [mapCenter, mapZoom]);\r\n\r\n  // Display recommendations when received\r\n  useEffect(() => {\r\n    if (!map.current || !mapLoaded || !recommendations) return;\r\n\r\n    // Convert recommendations to GeoJSON features\r\n    // Use city center as base with offsets for different sites\r\n    const centerLng = cityCenter?.[0] || -84.388;\r\n    const centerLat = cityCenter?.[1] || 33.749;\r\n\r\n    // Store site coordinates for later reference\r\n    const coordinates: [number, number][] = [];\r\n\r\n    const recommendedFeatures = recommendations.recommended_sites.map(\r\n      (site, index) => {\r\n        const coords: [number, number] = [\r\n          centerLng + (index % 3 - 1) * 0.05,\r\n          centerLat + (Math.floor(index / 3) - 1) * 0.05\r\n        ];\r\n        coordinates.push(coords);\r\n\r\n        return {\r\n          type: \"Feature\" as const,\r\n          geometry: {\r\n            type: \"Point\" as const,\r\n            coordinates: coords,\r\n          },\r\n          properties: {\r\n            name: site.name || `Site ${index + 1}`,\r\n            composite_score: site.composite_score,\r\n            poverty_rate: site.poverty_rate,\r\n            no_internet_pct: site.no_internet_pct,\r\n            recommendation_tier: site.recommendation_tier,\r\n          },\r\n        };\r\n      }\r\n    );\r\n\r\n    // Update state with site coordinates\r\n    setSiteCoordinates(coordinates);\r\n\r\n    const recommendationsGeoJSON = {\r\n      type: \"FeatureCollection\" as const,\r\n      features: recommendedFeatures,\r\n    };\r\n\r\n    // Add or update recommendations layer\r\n    if (map.current.getSource(\"ai-recommendations\")) {\r\n      (\r\n        map.current.getSource(\"ai-recommendations\") as mapboxgl.GeoJSONSource\r\n      ).setData(recommendationsGeoJSON);\r\n    } else {\r\n      map.current.addSource(\"ai-recommendations\", {\r\n        type: \"geojson\",\r\n        data: recommendationsGeoJSON,\r\n      });\r\n\r\n      map.current.addLayer({\r\n        id: \"ai-recommendations\",\r\n        type: \"circle\",\r\n        source: \"ai-recommendations\",\r\n        paint: {\r\n          \"circle-radius\": 10,\r\n          \"circle-color\": [\r\n            \"match\",\r\n            [\"get\", \"recommendation_tier\"],\r\n            \"top_priority\",\r\n            \"#DC2626\",\r\n            \"high_priority\",\r\n            \"#F59E0B\",\r\n            \"medium_priority\",\r\n            \"#3B82F6\",\r\n            \"#6B7280\",\r\n          ],\r\n          \"circle-stroke-width\": 2,\r\n          \"circle-stroke-color\": \"#fff\",\r\n        },\r\n      });\r\n\r\n      // Add popup on click and center map\r\n      map.current.on(\"click\", \"ai-recommendations\", (e) => {\r\n        if (!map.current || !e.features || !e.features[0]) return;\r\n        const feature = e.features[0];\r\n        const props = feature.properties;\r\n\r\n        // Center map on clicked point with smooth animation\r\n        map.current.flyTo({\r\n          center: e.lngLat,\r\n          zoom: 14,\r\n          duration: 1000,\r\n          essential: true\r\n        });\r\n\r\n        new mapboxgl.Popup()\r\n          .setLngLat(e.lngLat)\r\n          .setHTML(\r\n            `\r\n            <div style=\"font-family: system-ui; padding: 4px;\">\r\n              <strong style=\"color: #1f2937; font-size: 14px;\">${props?.name}</strong><br/>\r\n              <div style=\"margin-top: 8px; font-size: 12px; color: #6b7280;\">\r\n                <div><strong>Score:</strong> ${props?.composite_score}/100</div>\r\n                <div><strong>Poverty Rate:</strong> ${props?.poverty_rate}%</div>\r\n                <div><strong>No Internet:</strong> ${props?.no_internet_pct}%</div>\r\n                <div><strong>Priority:</strong> ${props?.recommendation_tier}</div>\r\n              </div>\r\n            </div>\r\n          `\r\n          )\r\n          .addTo(map.current);\r\n      });\r\n\r\n      map.current.on(\"mouseenter\", \"ai-recommendations\", () => {\r\n        if (map.current) map.current.getCanvas().style.cursor = \"pointer\";\r\n      });\r\n\r\n      map.current.on(\"mouseleave\", \"ai-recommendations\", () => {\r\n        if (map.current) map.current.getCanvas().style.cursor = \"\";\r\n      });\r\n    }\r\n\r\n    // Enable the layer in active layers\r\n    if (!activeLayers.includes(\"ai-recommendations\")) {\r\n      setActiveLayers((prev) => [...prev, \"ai-recommendations\"]);\r\n    }\r\n  }, [recommendations, mapLoaded]);\r\n\r\n  // Toggle layer visibility\r\n  const toggleLayer = (layerId: string) => {\r\n    if (!map.current || !mapLoaded) return;\r\n\r\n    setActiveLayers((prev) => {\r\n      const isActive = prev.includes(layerId);\r\n      const newLayers = isActive\r\n        ? prev.filter((id) => id !== layerId)\r\n        : [...prev, layerId];\r\n\r\n      // Update map layer visibility\r\n      if (map.current?.getLayer(layerId)) {\r\n        map.current.setLayoutProperty(\r\n          layerId,\r\n          \"visibility\",\r\n          isActive ? \"none\" : \"visible\"\r\n        );\r\n      }\r\n\r\n      return newLayers;\r\n    });\r\n  };\r\n\r\n  return (\r\n    <section className=\"w-full py-8\">\r\n      <div className=\"max-w-7xl mx-auto px-6\">\r\n        <div className=\"civic-card relative\">\r\n          <h2 className=\"text-2xl font-semibold text-foreground mb-4\">\r\n            {cityName ? `${cityName} WiFi Network Map` : \"Interactive Site Map\"}\r\n          </h2>\r\n\r\n          {/* Map Container */}\r\n          <div\r\n            className=\"relative w-full rounded-lg overflow-hidden\"\r\n            style={{ height: \"600px\" }}\r\n          >\r\n            <div\r\n              ref={mapContainer}\r\n              style={{\r\n                position: \"absolute\",\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                bottom: 0,\r\n                width: \"100%\",\r\n                height: \"100%\",\r\n              }}\r\n            />\r\n\r\n            {/* Layer Control */}\n            <MapLayerControl\n              layers={layerControlConfig}\n              activeLayers={activeLayers}\n              onToggle={toggleLayer}\n            />\n\r\n            {/* API Key Warning */}\r\n            {!MAPBOX_CONFIG.accessToken && (\r\n              <div className=\"absolute inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center\">\r\n                <div className=\"bg-white p-6 rounded-lg max-w-md text-center\">\r\n                  <p className=\"text-sm font-medium text-gray-900 mb-2\">\r\n                    Mapbox API Key Required\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-600\">\r\n                    Add NEXT_PUBLIC_MAPBOX_TOKEN to .env.local\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Map Legend */}\r\n          <div className=\"mt-4 grid grid-cols-3 gap-4 text-sm\">\r\n            <div>\r\n              <h4 className=\"font-medium text-foreground mb-2\">Census Data</h4>\r\n              <div className=\"space-y-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded bg-[#19B987]\" />\r\n                  <span className=\"text-accent\">High Poverty</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded bg-[#2691FF]\" />\r\n                  <span className=\"text-accent\">Low Internet Access</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"font-medium text-foreground mb-2\">Local Assets</h4>\r\n              <div className=\"space-y-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded-full bg-[#7C3AED]\" />\r\n                  <span className=\"text-accent\">Libraries</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded-full bg-[#DC2626]\" />\r\n                  <span className=\"text-accent\">Community Centers</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded-full bg-[#7DBDFF]\" />\r\n                  <span className=\"text-accent\">Transit Stops</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"font-medium text-foreground mb-2\">WiFi Sites</h4>\r\n              <div className=\"space-y-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded-full bg-[#2691FF]\" />\r\n                  <span className=\"text-accent\">Candidate Sites</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 rounded-full bg-[#6B7280]\" />\r\n                  <span className=\"text-accent\">Existing WiFi</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2293, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/SiteCard.tsx"],"sourcesContent":["import type { RecommendedSite } from '@/lib/types';\r\n\r\ntype SiteCardProps = {\r\n  rank: number;\r\n  site: RecommendedSite;\r\n  onClick?: () => void;\r\n};\r\n\r\n// Priority tier configuration\r\nconst tierConfig = {\r\n  top_priority: {\r\n    label: 'Critical',\r\n    color: '#ef4444',\r\n    textColor: 'text-red-500',\r\n  },\r\n  high_priority: {\r\n    label: 'High',\r\n    color: '#f59e0b',\r\n    textColor: 'text-amber-500',\r\n  },\r\n  medium_priority: {\r\n    label: 'Medium',\r\n    color: '#3b82f6',\r\n    textColor: 'text-blue-500',\r\n  },\r\n  low_priority: {\r\n    label: 'Low',\r\n    color: '#6b7280',\r\n    textColor: 'text-gray-500',\r\n  },\r\n};\r\n\r\n// Generate reasoning bullets from site metrics\r\nfunction generateReasoning(site: RecommendedSite): string[] {\r\n  const reasons: string[] = [];\r\n\r\n  if (site.poverty_rate && site.poverty_rate > 20) {\r\n    reasons.push(`High poverty area (${site.poverty_rate.toFixed(1)}% below poverty line)`);\r\n  }\r\n\r\n  if (site.no_internet_pct && site.no_internet_pct > 15) {\r\n    reasons.push(`Significant digital divide (${site.no_internet_pct.toFixed(1)}% without internet)`);\r\n  }\r\n\r\n  if (site.nearby_anchor_count && site.nearby_anchor_count > 0) {\r\n    reasons.push(`${site.nearby_anchor_count} nearby civic asset${site.nearby_anchor_count > 1 ? 's' : ''} for deployment`);\r\n  }\r\n\r\n  if (site.composite_score >= 80) {\r\n    reasons.push('Critical need - immediate deployment recommended');\r\n  }\r\n\r\n  if (site.student_population && site.student_population > 0) {\r\n    reasons.push(`Serves ${site.student_population.toLocaleString()} students`);\r\n  }\r\n\r\n  // Fallback if no specific reasons\r\n  if (reasons.length === 0) {\r\n    reasons.push('Meets multiple deployment criteria');\r\n  }\r\n\r\n  return reasons;\r\n}\r\n\r\n// Determine icon based on nearby anchors\r\nfunction getIcon(site: RecommendedSite): string {\r\n  if (site.nearest_library) return 'ðŸ“š';\r\n  if (site.nearest_community_center) return 'ðŸ›ï¸';\r\n  if (site.nearby_anchors && site.nearby_anchors.length > 0) {\r\n    const firstAsset = site.nearby_anchors[0];\r\n    if (firstAsset.type === 'library') return 'ðŸ“š';\r\n    if (firstAsset.type === 'community_center') return 'ðŸ›ï¸';\r\n    if (firstAsset.type === 'school') return 'ðŸ«';\r\n    if (firstAsset.type === 'transit') return 'ðŸš‡';\r\n  }\r\n  return 'ðŸ“'; // Default location pin\r\n}\r\n\r\nexport default function SiteCard({ rank, site, onClick }: SiteCardProps) {\r\n  const tier = tierConfig[site.recommendation_tier] || tierConfig.low_priority;\r\n  const reasoning = generateReasoning(site);\r\n  const icon = getIcon(site);\r\n  const displayName = site.name || `Census Tract ${site.tract_id}`;\r\n\r\n  return (\r\n    <div\r\n      className={`civic-card border-l-4 ${onClick ? 'cursor-pointer hover:bg-surface-hover transition-colors' : ''}`}\r\n      style={{ borderLeftColor: tier.color }}\r\n      onClick={onClick}\r\n    >\r\n      <div className=\"flex items-start gap-3\">\r\n        {/* Rank Badge */}\r\n        <div\r\n          className=\"shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm\"\r\n          style={{ backgroundColor: tier.color }}\r\n        >\r\n          {rank}\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"flex-1\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div>\r\n              <h3 className=\"text-base font-semibold text-foreground\">{displayName}</h3>\r\n              <div className=\"flex items-center gap-2 mt-1\">\r\n                <span\r\n                  className={`text-xs font-medium px-2 py-0.5 rounded ${tier.textColor}`}\r\n                  style={{ backgroundColor: `${tier.color}20` }}\r\n                >\r\n                  {tier.label} Priority\r\n                </span>\r\n                <span className=\"text-xs text-muted\">\r\n                  Tract {site.tract_id}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <span className=\"text-2xl\">{icon}</span>\r\n          </div>\r\n\r\n          {/* Metrics */}\r\n          <div className=\"grid grid-cols-2 gap-3 mt-3\">\r\n            <div>\r\n              <div className=\"text-lg font-semibold text-civic-green\">\r\n                {site.total_population?.toLocaleString() || '0'}\r\n              </div>\r\n              <div className=\"text-xs text-accent\">People Helped</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-lg font-semibold text-civic-blue\">\r\n                {site.composite_score?.toFixed(1) || '0.0'}\r\n              </div>\r\n              <div className=\"text-xs text-accent\">Score</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reasoning */}\r\n          <div className=\"mt-3 pt-3 border-t border-border\">\r\n            <p className=\"text-xs font-medium text-muted uppercase tracking-wider mb-2\">\r\n              Why this site?\r\n            </p>\r\n            <ul className=\"space-y-1\">\r\n              {reasoning.slice(0, 3).map((reason, idx) => (\r\n                <li key={idx} className=\"text-xs text-accent flex gap-2\">\r\n                  <span className=\"text-civic-green flex-shrink-0\">âœ“</span>\r\n                  <span>{reason}</span>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2581, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/components/RecommendationsSidebar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport SiteCard from './SiteCard';\r\nimport type { DeploymentPlan } from '@/lib/types';\r\n\r\ninterface RecommendationsSidebarProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  deploymentPlan: DeploymentPlan | null;\r\n  onSiteClick?: (siteIndex: number) => void;\r\n}\r\n\r\nexport default function RecommendationsSidebar({\r\n  isOpen,\r\n  onClose,\r\n  deploymentPlan,\r\n  onSiteClick\r\n}: RecommendationsSidebarProps) {\r\n  return (\r\n    <>\r\n      {/* Backdrop (optional, for mobile) */}\r\n      {isOpen && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/30 z-30 lg:hidden\"\r\n          onClick={onClose}\r\n        />\r\n      )}\r\n\r\n      {/* Right Sidebar */}\r\n      <div\r\n        className={`fixed top-0 right-0 h-full w-96 bg-surface border-l border-border z-40 transform transition-transform duration-300 ease-in-out ${\r\n          isOpen ? 'translate-x-0' : 'translate-x-full'\r\n        }`}\r\n      >\r\n        <div className=\"flex flex-col h-full\">\r\n          {/* Header */}\r\n          <div className=\"px-6 py-4 border-b border-border\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h2 className=\"text-lg font-semibold text-foreground\">\r\n                  WiFi Deployment Sites\r\n                </h2>\r\n                <p className=\"text-sm text-accent\">\r\n                  {deploymentPlan?.recommended_sites_count || 0} sites recommended\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-1 rounded-lg hover:bg-surface-hover transition-colors text-muted hover:text-foreground\"\r\n                title=\"Close recommendations\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          {deploymentPlan ? (\r\n            <>\r\n              {/* Impact Summary */}\r\n              <div className=\"px-6 py-4 border-b border-border bg-surface-hover\">\r\n                <h3 className=\"text-xs font-semibold text-muted uppercase tracking-wider mb-3\">\r\n                  Projected Impact\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div>\r\n                    <div className=\"text-2xl font-bold text-civic-green\">\r\n                      {deploymentPlan.projected_impact.total_population_served?.toLocaleString() || '0'}\r\n                    </div>\r\n                    <div className=\"text-xs text-accent mt-1\">People Reached</div>\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-2xl font-bold text-civic-blue\">\r\n                      {deploymentPlan.projected_impact.households_without_internet_served?.toLocaleString() || '0'}\r\n                    </div>\r\n                    <div className=\"text-xs text-accent mt-1\">Households Connected</div>\r\n                  </div>\r\n                </div>\r\n                {deploymentPlan.projected_impact.residents_in_poverty_served && (\r\n                  <div className=\"mt-3 pt-3 border-t border-border\">\r\n                    <div className=\"text-xl font-bold\" style={{ color: 'var(--civic-green)' }}>\r\n                      {deploymentPlan.projected_impact.residents_in_poverty_served.toLocaleString()}\r\n                    </div>\r\n                    <div className=\"text-xs text-accent mt-1\">Residents in Poverty Served</div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Scrollable Site List */}\r\n              <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-3\">\r\n                {deploymentPlan.recommended_sites.map((site, index) => (\r\n                  <SiteCard\r\n                    key={site.tract_id}\r\n                    site={site}\r\n                    rank={index + 1}\r\n                    onClick={onSiteClick ? () => onSiteClick(index) : undefined}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </>\r\n          ) : (\r\n            /* Empty State */\r\n            <div className=\"flex-1 flex items-center justify-center px-6\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-4xl mb-3\">ðŸ“Š</div>\r\n                <p className=\"text-foreground font-medium\">No recommendations yet</p>\r\n                <p className=\"text-accent text-sm mt-2\">\r\n                  Ask the AI assistant about WiFi deployment to see ranked sites\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAYe,SAAS,uBAAuB,EAC7C,MAAM,EACN,OAAO,EACP,cAAc,EACd,WAAW,EACiB;IAC5B,qBACE;;YAEG,wBACC,8OAAC;gBACC,WAAU;gBACV,SAAS;;;;;;0BAKb,8OAAC;gBACC,WAAW,CAAC,+HAA+H,EACzI,SAAS,kBAAkB,oBAC3B;0BAEF,cAAA,8OAAC;oBAAI,WAAU;;sCAEb,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;0DAAwC;;;;;;0DAGtD,8OAAC;gDAAE,WAAU;;oDACV,gBAAgB,2BAA2B;oDAAE;;;;;;;;;;;;;kDAGlD,8OAAC;wCACC,SAAS;wCACT,WAAU;wCACV,OAAM;kDAEN,cAAA,8OAAC;4CAAI,WAAU;4CAAU,MAAK;4CAAO,QAAO;4CAAe,SAAQ;sDACjE,cAAA,8OAAC;gDAAK,eAAc;gDAAQ,gBAAe;gDAAQ,aAAa;gDAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;wBAO5E,+BACC;;8CAEE,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAG,WAAU;sDAAiE;;;;;;sDAG/E,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;;sEACC,8OAAC;4DAAI,WAAU;sEACZ,eAAe,gBAAgB,CAAC,uBAAuB,EAAE,oBAAoB;;;;;;sEAEhF,8OAAC;4DAAI,WAAU;sEAA2B;;;;;;;;;;;;8DAE5C,8OAAC;;sEACC,8OAAC;4DAAI,WAAU;sEACZ,eAAe,gBAAgB,CAAC,kCAAkC,EAAE,oBAAoB;;;;;;sEAE3F,8OAAC;4DAAI,WAAU;sEAA2B;;;;;;;;;;;;;;;;;;wCAG7C,eAAe,gBAAgB,CAAC,2BAA2B,kBAC1D,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;oDAAoB,OAAO;wDAAE,OAAO;oDAAqB;8DACrE,eAAe,gBAAgB,CAAC,2BAA2B,CAAC,cAAc;;;;;;8DAE7E,8OAAC;oDAAI,WAAU;8DAA2B;;;;;;;;;;;;;;;;;;8CAMhD,8OAAC;oCAAI,WAAU;8CACZ,eAAe,iBAAiB,CAAC,GAAG,CAAC,CAAC,MAAM,sBAC3C,8OAAC,kIAAQ;4CAEP,MAAM;4CACN,MAAM,QAAQ;4CACd,SAAS,cAAc,IAAM,YAAY,SAAS;2CAH7C,KAAK,QAAQ;;;;;;;;;;;2CAS1B,eAAe,iBACf,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAgB;;;;;;kDAC/B,8OAAC;wCAAE,WAAU;kDAA8B;;;;;;kDAC3C,8OAAC;wCAAE,WAAU;kDAA2B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUxD"}},
    {"offset": {"line": 2857, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/toast/Documents/Coding/ImsoATL/app/frontend/app/dashboard/%5Bcity%5D/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport DashboardHeader from '@/components/DashboardHeader';\r\nimport ChatSidebar from '@/components/ChatSidebar';\r\nimport PrioritySliders from '@/components/PrioritySliders';\r\nimport InteractiveMap from '@/components/InteractiveMap';\r\nimport RecommendationsSidebar from '@/components/RecommendationsSidebar';\r\nimport Footer from '@/components/Footer';\r\nimport type { DeploymentPlan, MapOverlayEvent } from '@/lib/types';\n\r\ntype CityData = {\r\n  id: number;\r\n  name: string;\r\n  state: string;\r\n  slug: string;\r\n  coords: [number, number];\r\n};\r\n\r\n// Mock recommendations for Madison County\r\nconst MOCK_MADISON_RECOMMENDATIONS: DeploymentPlan = {\r\n  recommended_sites: [\r\n    {\r\n      name: \"Madison County Courthouse Area\",\r\n      composite_score: 92.5,\r\n      poverty_rate: 28.3,\r\n      no_internet_pct: 35.2,\r\n      recommendation_tier: \"top_priority\",\r\n      tract_id: \"12079001100\"\r\n    },\r\n    {\r\n      name: \"Downtown Madison\",\r\n      composite_score: 88.7,\r\n      poverty_rate: 24.1,\r\n      no_internet_pct: 31.8,\r\n      recommendation_tier: \"top_priority\",\r\n      tract_id: \"12079001200\"\r\n    },\r\n    {\r\n      name: \"Lee Elementary School Area\",\r\n      composite_score: 85.2,\r\n      poverty_rate: 32.5,\r\n      no_internet_pct: 38.4,\r\n      recommendation_tier: \"high_priority\",\r\n      tract_id: \"12079001300\"\r\n    },\r\n    {\r\n      name: \"Greenville Community\",\r\n      composite_score: 82.1,\r\n      poverty_rate: 26.9,\r\n      no_internet_pct: 29.7,\r\n      recommendation_tier: \"high_priority\",\r\n      tract_id: \"12079001400\"\r\n    },\r\n    {\r\n      name: \"Pinetta Area\",\r\n      composite_score: 78.4,\r\n      poverty_rate: 22.3,\r\n      no_internet_pct: 27.1,\r\n      recommendation_tier: \"medium_priority\",\r\n      tract_id: \"12079001500\"\r\n    }\r\n  ],\r\n  recommended_sites_count: 5,\r\n  total_cost: 450000,\r\n  total_reach: 12500,\r\n  equity_score: 87.3,\r\n  projected_impact: {\r\n    total_population_served: 12500,\r\n    households_without_internet_served: 4200,\r\n    residents_in_poverty_served: 3500\r\n  }\r\n};\r\n\r\nexport default function DashboardPage({ params }: { params: { city: string } }) {\r\n  const [cityData, setCityData] = useState<CityData | null>(null);\r\n  const [isChatOpen, setIsChatOpen] = useState(true);\r\n  const [isRecommendationsOpen, setIsRecommendationsOpen] = useState(false);\r\n  const [recommendations, setRecommendations] = useState<DeploymentPlan | null>(null);\n  const [mapOverlay, setMapOverlay] = useState<MapOverlayEvent | null>(null);\n  const mapRef = useRef<{\r\n    showRecommendations: (plan: DeploymentPlan) => void;\r\n    centerOnSite: (siteIndex: number) => void;\r\n  } | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Retrieve city data from localStorage\r\n    const storedCity = localStorage.getItem('selectedCity');\r\n    if (storedCity) {\r\n      const city = JSON.parse(storedCity) as CityData;\r\n      setCityData(city);\r\n\r\n      // Load mock recommendations for Madison County\r\n      if (city.slug === 'madison-county-fl') {\r\n        setRecommendations(MOCK_MADISON_RECOMMENDATIONS);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const handleRecommendationsReceived = (plan: DeploymentPlan) => {\n    setRecommendations(plan);\n    setIsRecommendationsOpen(true); // Auto-open recommendations sidebar\n    // Notify map component to show recommendations\n    if (mapRef.current && mapRef.current.showRecommendations) {\n      mapRef.current.showRecommendations(plan);\n    }\n  };\n\n  const handleMapOverlayReceived = (overlay: MapOverlayEvent) => {\n    setMapOverlay(overlay);\n  };\n\r\n  const handleSiteClick = (siteIndex: number) => {\r\n    // Center map on the clicked site\r\n    if (mapRef.current && mapRef.current.centerOnSite) {\r\n      mapRef.current.centerOnSite(siteIndex);\r\n    }\r\n  };\r\n\r\n  if (!cityData) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <p className=\"text-foreground\">Loading dashboard...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background flex\">\r\n      {/* Chat Sidebar (Left) */}\r\n      <ChatSidebar\n        isOpen={isChatOpen}\n        onClose={() => setIsChatOpen(false)}\n        cityName={cityData.name}\n        onRecommendationsReceived={handleRecommendationsReceived}\n        onMapOverlayReceived={handleMapOverlayReceived}\n      />\n\r\n      {/* Recommendations Sidebar (Right) */}\r\n      <RecommendationsSidebar\r\n        isOpen={isRecommendationsOpen}\r\n        onClose={() => setIsRecommendationsOpen(false)}\r\n        deploymentPlan={recommendations}\r\n        onSiteClick={handleSiteClick}\r\n      />\r\n\r\n      {/* Header - Fixed position, unaffected by sidebars */}\r\n      <DashboardHeader\r\n        onToggleChat={() => setIsChatOpen(!isChatOpen)}\r\n        onToggleRecommendations={() => setIsRecommendationsOpen(!isRecommendationsOpen)}\r\n        cityName={cityData.name}\r\n      />\r\n\r\n      {/* Main Dashboard - shifts when sidebars are open */}\r\n      <div\r\n        className={`flex-1 transition-all duration-300 pt-[73px] ${\r\n          isChatOpen ? 'ml-[32rem]' : 'ml-0'\r\n        } ${\r\n          isRecommendationsOpen ? 'mr-96' : 'mr-0'\r\n        }`}\r\n      >\r\n        <div className=\"relative\">\r\n          {/* <PrioritySliders /> */}\r\n          <InteractiveMap\n            cityCenter={cityData.coords}\n            cityName={cityData.name}\n            citySlug={cityData.slug}\n            recommendations={recommendations}\n            overlayEvent={mapOverlay}\n            mapRefProp={mapRef}\n          />\n          {/* <Footer /> */}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}